<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pi Substring Finder</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; padding: 24px; background: #0b0f14; color: #e6edf3; }
    .card { max-width: 860px; margin: 0 auto; background: #121a23; border: 1px solid #233244; border-radius: 14px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    h1 { margin: 0 0 8px; font-size: 20px; }
    p { margin: 8px 0 14px; color: #b7c4d6; line-height: 1.4; }
    .row { display: grid; grid-template-columns: 1fr 220px; gap: 12px; align-items: end; }
    label { display: block; font-size: 12px; color: #b7c4d6; margin-bottom: 6px; }
    input, button { width: 100%; box-sizing: border-box; padding: 10px 12px; border-radius: 10px; border: 1px solid #2b3d53; background: #0e1620; color: #e6edf3; }
    input::placeholder { color: #6f829b; }
    button { cursor: pointer; border-color: #375a86; background: linear-gradient(180deg, #1a3b63, #122b4a); font-weight: 600; }
    button:disabled { cursor: not-allowed; opacity: .6; }
    .smallrow { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
    .status { margin-top: 14px; padding: 12px; border-radius: 12px; background: #0e1620; border: 1px solid #233244; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .ok { color: #8ef0a8; }
    .warn { color: #ffd27a; }
    .bad { color: #ff9aa2; }
    .hint { color: #9db0c7; font-size: 12px; margin-top: 10px; }
    .grid3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-top: 12px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Find a string inside π</h1>
    <p>
      Enter digits (like <span class="mono">14</span> or <span class="mono">271828</span>) and this page finds where they first appear in π
      <em>after the decimal point</em>. Locations are <strong>1-based</strong>:
      <span class="mono">14 → 1</span>, <span class="mono">15 → 3</span>.
    </p>

    <div class="row">
      <div>
        <label for="query">Digits to find</label>
        <input id="query" inputmode="numeric" placeholder="e.g. 14 or 314159" autocomplete="off" />
      </div>
      <div>
        <label>&nbsp;</label>
        <button id="findBtn">Generate π & Search</button>
      </div>
    </div>

    <div class="grid3">
      <div>
        <label for="digits">π digits to generate/search</label>
        <input id="digits" inputmode="numeric" value="200000" />
      </div>
      <div>
        <label for="chunk">UI update chunk (digits)</label>
        <input id="chunk" inputmode="numeric" value="5000" />
      </div>
      <div>
        <label for="maxLen">Max query length</label>
        <input id="maxLen" inputmode="numeric" value="64" />
      </div>
    </div>

    <div class="smallrow">
      <button id="demo14">Demo: find 14</button>
      <button id="demo15">Demo: find 15</button>
    </div>

    <div class="status" id="status">
      <div><strong>Status:</strong> <span id="statusText" class="warn">Ready.</span></div>
      <div style="margin-top:8px" class="mono" id="result"></div>
      <div style="margin-top:8px" class="mono" id="preview"></div>
      <div class="hint">
        Tip: Generating 200k digits is fine in most modern browsers. If you want to search deeper, increase “π digits”
        (it will take longer).
      </div>
    </div>
  </div>

<script>
/**
 * Pi digit generator (base-10 spigot).
 * Produces digits of pi in order. First digit is '3', then decimal digits.
 * Reference: Rabinowitz & Wagon spigot algorithm (adapted).
 */
function generatePiDigits(countDigits, onProgress) {
  // countDigits includes the leading '3' + (countDigits-1) more digits
  // We'll generate exactly countDigits digits total.
  const n = Math.floor((countDigits * 10) / 3) + 1;
  const a = new Int32Array(n);
  a.fill(2);

  let nines = 0;
  let predigit = 0;
  let out = "";

  for (let j = 0; j < countDigits; j++) {
    let q = 0;
    for (let i = n - 1; i >= 0; i--) {
      const x = 10 * a[i] + q * (i + 1);
      const denom = 2 * (i + 1) - 1;
      a[i] = x % denom;
      q = Math.floor(x / denom);
    }
    a[0] = q % 10;
    q = Math.floor(q / 10);

    if (q === 9) {
      nines++;
    } else if (q === 10) {
      out += String(predigit + 1);
      for (let k = 0; k < nines; k++) out += "0";
      predigit = 0;
      nines = 0;
    } else {
      out += String(predigit);
      predigit = q;
      if (nines !== 0) {
        for (let k = 0; k < nines; k++) out += "9";
        nines = 0;
      }
    }

    if (onProgress && (j % 5000 === 0) && j !== 0) onProgress(j, out.length);
  }

  out += String(predigit);
  return out; // includes a leading '0' artifact; we fix below.
}

function normalizeSpigotOutput(raw, wantTotalDigits) {
  // The standard spigot adaptation emits a leading '0' then digits of pi.
  // We remove the first char and keep wantTotalDigits digits.
  const s = raw.slice(1);
  return s.slice(0, wantTotalDigits);
}

function setStatus(text, cls) {
  const el = document.getElementById("statusText");
  el.textContent = text;
  el.className = cls || "";
}

function prettyNum(x) {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

async function runSearch(query) {
  const digitsToGen = Math.max(50, parseInt(document.getElementById("digits").value, 10) || 200000);
  const chunk = Math.max(1000, parseInt(document.getElementById("chunk").value, 10) || 5000);
  const maxLen = Math.max(1, parseInt(document.getElementById("maxLen").value, 10) || 64);

  const resultEl = document.getElementById("result");
  const previewEl = document.getElementById("preview");
  resultEl.textContent = "";
  previewEl.textContent = "";

  query = (query || "").trim();
  if (!/^\d+$/.test(query)) {
    setStatus("Please enter digits only (0–9).", "bad");
    return;
  }
  if (query.length > maxLen) {
    setStatus(`Query too long (max ${maxLen}).`, "bad");
    return;
  }

  // We'll generate digits of pi including the leading '3'
  // and search only AFTER the decimal, so we'll need at least 1 + digitsAfterDecimal.
  const totalDigits = digitsToGen; // includes the leading '3'
  const digitsAfterDecimal = totalDigits - 1;

  setStatus(`Generating ${prettyNum(totalDigits)} digits of π…`, "warn");

  // Generate in a microtask to allow UI paint
  await new Promise(requestAnimationFrame);

  let lastProgress = 0;
  const raw = generatePiDigits(totalDigits, (j, outLen) => {
    // Update status roughly based on loop j
    if (j - lastProgress >= chunk) {
      lastProgress = j;
      setStatus(`Generating π… step ${prettyNum(j)} / ${prettyNum(totalDigits)}`, "warn");
    }
  });
  const piDigits = normalizeSpigotOutput(raw, totalDigits); // e.g. "31415926..."
  const afterDecimal = piDigits.slice(1); // drop the leading '3'

  setStatus(`Searching for "${query}" in ${prettyNum(digitsAfterDecimal)} decimal digits…`, "warn");
  await new Promise(requestAnimationFrame);

  const idx = afterDecimal.indexOf(query); // 0-based
  if (idx === -1) {
    setStatus("Not found in the generated range.", "bad");
    resultEl.textContent =
      `Searched first ${prettyNum(digitsAfterDecimal)} digits after the decimal.\n` +
      `Try increasing “π digits to generate/search”.`;
    return;
  }

  // Convert to 1-based location after decimal
  const location1Based = idx + 1;

  setStatus("Found!", "ok");
  resultEl.textContent =
    `First occurrence location (1-based, after the decimal): ${prettyNum(location1Based)}\n` +
    `0-based index (after the decimal): ${prettyNum(idx)}\n` +
    `Example check: "14" → 1, "15" → 3`;

  // Show a little context around the match
  const start = Math.max(0, idx - 10);
  const end = Math.min(afterDecimal.length, idx + query.length + 10);
  const context = afterDecimal.slice(start, end);
  const caret = " ".repeat(idx - start) + "^".repeat(query.length);

  previewEl.textContent =
    `π = 3.${afterDecimal.slice(0, 60)}…\n\n` +
    `Context (after decimal):\n` +
    `${context}\n` +
    `${caret}`;
}

document.getElementById("findBtn").addEventListener("click", () => {
  runSearch(document.getElementById("query").value);
});
document.getElementById("demo14").addEventListener("click", () => {
  document.getElementById("query").value = "14";
  runSearch("14");
});
document.getElementById("demo15").addEventListener("click", () => {
  document.getElementById("query").value = "15";
  runSearch("15");
});

// Enter key triggers search
document.getElementById("query").addEventListener("keydown", (e) => {
  if (e.key === "Enter") runSearch(document.getElementById("query").value);
});
</script>
</body>
</html>
